{% for user in users %}
<tr data-username="{{ user.username }}">
    <td>
        <div class="d-flex align-items-center">
            <div class="avatar bg-primary text-white rounded-circle me-3"
                 style="width: 36px; height: 36px; line-height: 36px; text-align: center;">
                {{ user.first_name[0] if user.first_name else user.username[0] }}{{ user.last_name[0] if user.last_name else '' }}
            </div>
            <div>
                <div class="fw-bold">{{ user.first_name }} {{ user.last_name }}</div>
                <small class="text-muted">{{ user.username }}</small>
            </div>
        </div>
    </td>
    <td>{{ user.email }}</td>
    <td>
        <span class="badge {{ 'bg-primary' if user.role == 'admin' else 'bg-secondary' }}">
            {{ user.role|title }}
        </span>
    </td>
    <td>
        {% if user.is_active %}
        <span class="badge bg-success">Active</span>
        {% else %}
        <span class="badge bg-danger">Inactive</span>
        {% endif %}
    </td>
    <td>
        {% if user.approved_apps %}
            {% if '*' in user.approved_apps %}
                <span class="badge bg-warning">All Projects</span>
            {% else %}
                <span class="text-muted">{{ user.approved_apps|length }} project(s)</span>
            {% endif %}
        {% else %}
            <span class="text-muted">No projects</span>
        {% endif %}
    </td>
    <td>
        <div class="btn-group btn-group-sm">
            <button class="btn btn-outline-primary"
                    hx-get="/htmx/user/projects-modal/{{ user.username }}"
                    hx-target="#user-projects-modal-content"
                    data-bs-toggle="modal"
                    data-bs-target="#userProjectsModal">
                <i class="fas fa-project-diagram"></i>
            </button>

            <button class="btn btn-outline-secondary"
                    hx-get="/htmx/user/edit/{{ user.username }}"
                    hx-target="#user-edit-modal-content"
                    data-bs-toggle="modal"
                    data-bs-target="#userEditModal">
                <i class="fas fa-edit"></i>
            </button>

            {% if user.is_active %}
            <button class="btn btn-outline-warning"
                    hx-post="/htmx/user/deactivate/{{ user.username }}"
                    hx-target="closest tr"
                    hx-swap="outerHTML"
                    hx-confirm="Deactivate user {{ user.username }}?">
                <i class="fas fa-pause"></i>
            </button>
            {% else %}
            <button class="btn btn-outline-success"
                    hx-post="/htmx/user/activate/{{ user.username }}"
                    hx-target="closest tr"
                    hx-swap="outerHTML"
                    hx-confirm="Activate user {{ user.username }}?">
                <i class="fas fa-play"></i>
            </button>
            {% endif %}
        </div>
    </td>
</tr>
{% endfor %}