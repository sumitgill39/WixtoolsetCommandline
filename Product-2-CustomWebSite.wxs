<?xml version="1.0" encoding="UTF-8"?>
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi"
     xmlns:iis="http://schemas.microsoft.com/wix/IIsExtension"
     xmlns:util="http://schemas.microsoft.com/wix/UtilExtension">

  <!-- CHANGE THESE VALUES FOR YOUR APPLICATION -->
  <?define AppName = "EListner" ?>
  <?define AppVersion = "1.1.0.0" ?>
  <?define CompanyName = "Your Company" ?>
  <?define AppUpgradeCode = "6042d831-d640-4f28-923d-1d405c628e46" ?> <!-- GENERATE NEW GUID IF NEEDED -->
  <?define TargetWebSiteName = "www.mmc.com" ?>

  <Product 
    Id="*"
    Name="$(var.AppName)"
    Language="1033"
    Version="$(var.AppVersion)"
    Manufacturer="$(var.CompanyName)"
    UpgradeCode="$(var.AppUpgradeCode)">

    <Package InstallerVersion="200"
             Compressed="yes"
             InstallScope="perMachine" />

    <MajorUpgrade DowngradeErrorMessage="A newer version is already installed." />

    <MediaTemplate EmbedCab="yes" />

    <!-- Default installation path - user can change this -->
    <Property Id="WIXUI_INSTALLDIR" Value="INSTALLFOLDER" />
    <Property Id="INSTALLFOLDER" Value="C:\WebApps\$(var.AppName)" />

    <!-- Directory structure -->
    <Directory Id="TARGETDIR" Name="SourceDir">
      <!-- User can choose installation directory -->
      <Directory Id="INSTALLFOLDER" />
    </Directory>

    <!-- ALL YOUR WEB FILES WILL BE INCLUDED FROM Files.wxs -->
    <!-- This file will be auto-generated by heat.exe -->

    <!-- Create Application Pool -->
    <ComponentGroup Id="AppPool">
      <Component Id="CreateAppPool" Directory="INSTALLFOLDER" Guid="11ff20b7-cbb4-4872-93df-3d3138828426">
        <iis:WebAppPool Id="MyAppPool"
                        Name="$(var.AppName)AppPool"
                        ManagedRuntimeVersion="v4.0" />
        <CreateFolder />
      </Component>
    </ComponentGroup>

    <!-- Create Web Application -->
    <ComponentGroup Id="WebApp">
      <Component Id="CreateWebApp" Directory="INSTALLFOLDER" Guid="880fdd20-021b-4849-bd0e-b9935c4d208e">
        <!-- Create Virtual Directory under Target Web Site -->
        <iis:WebVirtualDir Id="MyVirtualDir"
                           Alias="$(var.AppName)"
                           Directory="INSTALLFOLDER"
                           WebSite="TargetWebSite">
          <!-- Create Application inside Virtual Directory -->
          <iis:WebApplication Id="MyWebApplication"
                              Name="$(var.AppName)"
                              WebAppPool="MyAppPool" />
        </iis:WebVirtualDir>
        <CreateFolder />
      </Component>
    </ComponentGroup>

    <!-- Website Reference - OUTSIDE components (CORRECT) -->
    <iis:WebSite Id="TargetWebSite"
                 Description="$(var.TargetWebSiteName)">
      <!-- Minimal WebAddress required by WiX schema -->
      <iis:WebAddress Id="MinimalWebAddress" Port="80" IP="*" />
    </iis:WebSite>

    <!-- What to install -->
    <Feature Id="Complete" Title="$(var.AppName)" Level="1">
      <ComponentGroupRef Id="WebApplicationFiles" /> <!-- This comes from Files.wxs -->
      <ComponentGroupRef Id="AppPool" />
      <ComponentGroupRef Id="WebApp" />
    </Feature>

    <!-- User Interface for selecting installation directory -->
    <UI>
      <UIRef Id="WixUI_InstallDir" />
    </UI>

  </Product>
</Wix>
