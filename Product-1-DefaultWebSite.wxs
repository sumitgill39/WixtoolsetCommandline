<?xml version="1.0" encoding="UTF-8"?>
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi"
     xmlns:iis="http://schemas.microsoft.com/wix/IIsExtension"
     xmlns:util="http://schemas.microsoft.com/wix/UtilExtension">

  <!-- CHANGE THESE VALUES FOR YOUR APPLICATION -->
  <?define AppName = "EBooker" ?>
  <?define AppVersion = "1.0.0.0" ?>
  <?define CompanyName = "Your Company" ?>
  <?define AppUpgradeCode = "cfcc7ad0-a6d3-4934-8bfd-ab546fecd6cf" ?> <!-- GENERATE NEW GUID IF NEEDED -->

  <Product 
    Id="*"
    Name="$(var.AppName)"
    Language="1033"
    Version="$(var.AppVersion)"
    Manufacturer="$(var.CompanyName)"
    UpgradeCode="$(var.AppUpgradeCode)">

    <Package InstallerVersion="200" Compressed="yes" InstallScope="perMachine" />

    <MajorUpgrade DowngradeErrorMessage="A newer version is already installed." />

    <MediaTemplate EmbedCab="yes" />

    <!-- Default installation path - user can change this -->
    <Property Id="WIXUI_INSTALLDIR" Value="INSTALLFOLDER" />
    <Property Id="INSTALLFOLDER" Value="C:\WebApps\$(var.AppName)" />

    <!-- Directory structure -->
    <Directory Id="TARGETDIR" Name="SourceDir">
      <!-- User can choose installation directory -->
      <Directory Id="INSTALLFOLDER" />
    </Directory>

    <!-- ALL YOUR WEB FILES WILL BE INCLUDED FROM Files.wxs -->
    <!-- This file will be auto-generated by heat.exe -->

    <!-- Create Application Pool -->
    <ComponentGroup Id="AppPool">
      <Component Id="CreateAppPool" Directory="INSTALLFOLDER" Guid="f6c03b8b-c4c1-443b-a9fc-0c35d18ea491">
        <iis:WebAppPool Id="MyAppPool"
                        Name="$(var.AppName)AppPool"
                        ManagedRuntimeVersion="v4.0" />
        <CreateFolder />
      </Component>
    </ComponentGroup>

    <!-- Create Web Application -->
    <ComponentGroup Id="WebApp">
      <Component Id="CreateWebApp" Directory="INSTALLFOLDER" Guid="00673c50-b34c-437e-8cf1-d3acdd079be8">
        <!-- Create Virtual Directory under Default Web Site -->
        <iis:WebVirtualDir Id="MyVirtualDir" Alias="$(var.AppName)" Directory="INSTALLFOLDER">
          <!-- Create Application inside Virtual Directory -->
          <iis:WebApplication Id="MyWebApplication"
                              Name="$(var.AppName)"
                              WebAppPool="MyAppPool" />
        </iis:WebVirtualDir>
        <CreateFolder />
      </Component>
    </ComponentGroup>

    <!-- Reference to existing Default Web Site -->
    <ComponentGroup Id="WebSiteRef">
      <Component Id="DefaultWebSiteRef" Directory="INSTALLFOLDER" Guid="1e26f129-9c53-47e7-bc9a-653b6d8ef5f2" NeverOverwrite="yes">
        <iis:WebSite Id="DefaultWebSite"
                     Description="Default Web Site"
                     Directory="INSTALLFOLDER"
                     ConfigureIfExists="no">
          <iis:WebAddress Id="DefaultWebSiteAddress" Port="80" IP="*" />
        </iis:WebSite>
        <CreateFolder />
      </Component>
    </ComponentGroup>

    <!-- What to install -->
    <Feature Id="Complete" Title="$(var.AppName)" Level="1">
      <ComponentGroupRef Id="WebApplicationFiles" /> <!-- This comes from Files.wxs -->
      <ComponentGroupRef Id="AppPool" />
      <ComponentGroupRef Id="WebApp" />
      <ComponentGroupRef Id="WebSiteRef" />
    </Feature>

    <!-- User Interface for selecting installation directory -->
    <UI>
      <UIRef Id="WixUI_InstallDir" />
    </UI>

  </Product>
</Wix>
